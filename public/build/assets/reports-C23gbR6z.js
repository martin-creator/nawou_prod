import{K as z,m as M,r as f,j as e,L as B,A as O}from"./app-CjojL7o4.js";import{D as F}from"./data-table-DfzsTp3c.js";import{E as q}from"./empty-state-BPIhuMHa.js";import{A as R,a as P,b as $,c as H,d as Y,e as U,f as G,g as J,E as Q,P as V}from"./alert-dialog-xSuUN_1u.js";import{B as o}from"./button-spm6lUZt.js";import{D as W,a as X,b as Z,c as ee}from"./dialog-DWCYBot6.js";import{D as se,a as re,b as te,c as y,d as ae}from"./dropdown-menu-DFrwRntd.js";import{I as v}from"./input-DAFae20J.js";import{L as b}from"./label-CHU0coym.js";import{T as ie}from"./textarea-C3eM8F07.js";import{A as le}from"./app-layout-BJ3c8a2H.js";import{t as c}from"./sonner-Cfn8jJHe.js";import{C as k}from"./circle-plus-CR_Nagd5.js";import{L as A}from"./loader-circle-DB9Bem-8.js";import{E as ne}from"./external-link-CiAhPAwR.js";import{T as oe}from"./trash-2-bTvAafOo.js";/* empty css            */import"./index-Bxj-7aYd.js";import"./index-B9vvPJFE.js";import"./index-aZ5NweBy.js";import"./index-W549pnCZ.js";import"./index-Ca_Fi7Ld.js";import"./index-bUXnhzLG.js";import"./index-bRVrMJT5.js";import"./use-mobile-D_DsnGmE.js";import"./tooltip-F5MKh358.js";import"./chevron-right-BgbkiVcS.js";const ce=[{title:"Dashboard",href:"/panel"},{title:"Annual reports",href:"/reports"}];function Be(){var C;const{reports:p}=z().props,{data:d,setData:l,post:_,processing:n,reset:m,patch:E,delete:S}=M({report_file:null,year:"",key_impacts:[{title:"",description:""}]}),[K,a]=f.useState(!1),[I,j]=f.useState(!1),[i,g]=f.useState(null),[u,x]=f.useState(null),N=(s,r,t)=>{const h=[...d.key_impacts];h[s][r]=t,l("key_impacts",h)},L=()=>{l("key_impacts",[...d.key_impacts,{title:"",description:""}])},T=s=>{const r=d.key_impacts.filter((t,h)=>h!==s);l("key_impacts",r)},D=s=>{s.preventDefault(),u?E(route("reports",{id:u}),{onSuccess:()=>{c.success("Anuual report updated successfully!"),a(!1),m()},onError:r=>{for(const t in r)c.error(`${t} error`,{description:r[t],closeButton:!0,className:"capitalize"})},onFinish:()=>{g(null),x(null)}}):i?S(route("reports",{id:i==null?void 0:i.id}),{onSuccess:()=>{c.success("Anuual report deleted successfully!"),a(!1),m(),j(!1)},onError:r=>{for(const t in r)c.error(`${t} error`,{description:r[t],closeButton:!0,className:"capitalize"})},onFinish:()=>{g(null),x(null)}}):_(route("reports"),{onSuccess:()=>{c.success("Saved!",{description:"Annual report has been saved successfully.",closeButton:!0}),a(!1),m()},onError:r=>{for(const t in r)c.error(`${t} error`,{description:r[t],closeButton:!0,className:"capitalize"})}})},w=[{accessorKey:"id",header:()=>e.jsx("div",{className:"text-center",children:"#"}),cell:({row:s})=>e.jsxs("div",{className:"text-center font-medium",children:[s.index+1,"."]})},{accessorKey:"year",header:()=>e.jsx("div",{className:"text-left",children:"Year"}),cell:({row:s})=>e.jsx("div",{className:"flex cursor-pointer items-center gap-2",children:e.jsx("div",{children:e.jsx("div",{className:"text-left font-medium",children:s.original.year})})})},{accessorKey:"key_impacts",header:()=>e.jsx("div",{className:"text-left",children:"Key Impacts"}),cell:({row:s})=>{var r;return e.jsx("div",{className:"flex cursor-pointer items-center gap-2",children:e.jsx("div",{children:e.jsxs("div",{className:"text-left font-medium",children:[(r=s.original.key_impacts)==null?void 0:r.length," Items"]})})})}},{accessorKey:"updated_at",header:()=>e.jsx("div",{className:"text-left",children:"Last Updated"}),cell:({row:s})=>e.jsx("div",{className:"text-left font-medium",children:new Date(s.original.updated_at).toLocaleString()})},{id:"actions",enableHiding:!0,cell:({row:s})=>e.jsxs(se,{children:[e.jsx(re,{asChild:!0,children:e.jsxs(o,{variant:"outline",className:"h-5 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(Q,{})]})}),e.jsxs(te,{align:"end",children:[e.jsx("a",{href:s.original.report_file,target:"_blank",rel:"noopener noreferrer",children:e.jsxs(y,{children:[e.jsx(ne,{}),"Open"]})}),e.jsxs(y,{onClick:()=>{l(s.original),x(s.original.id),a(!0)},children:[e.jsx(V,{}),"Edit"]}),e.jsx(ae,{}),e.jsxs(y,{onClick:()=>{g(s.original),j(!0)},children:[e.jsx(oe,{}),"Delete"]})]})]})}];return e.jsxs(le,{breadcrumbs:ce,children:[e.jsx(B,{title:"Annual reports"}),e.jsx("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:e.jsx(O,{data:"reports",fallback:"Loading...",children:(p==null?void 0:p.length)>0?e.jsx(F,{columns:w,data:p,searchableColumn:"year",placeholder:"Search report year...",type:"reports",actions:e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>{a(!0)},children:[e.jsx(k,{})," Create"]})}):e.jsx(q,{actions:e.jsxs(o,{variant:"outline",onClick:()=>a(!0),children:[e.jsx(k,{})," Create New"]})})})}),e.jsx(W,{open:K,onOpenChange:s=>{a(s),s==!1&&(m(),x(null))},children:e.jsxs(X,{className:"max-h-[700px] overflow-auto",children:[e.jsxs(Z,{children:[u?"Editing":"Add"," Annual Report"]}),e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(b,{className:"capitalize",children:"Year"}),e.jsx(v,{type:"number",disabled:n,value:d.year,onChange:s=>l("year",s.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(b,{className:"capitalize",children:"Annual report File"}),e.jsx(v,{type:"file",disabled:n,onChange:s=>l("report_file",s.target.files[0]),accept:".pdf,.doc,.docx",required:!u})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(b,{children:"Key Impacts"}),(C=d.key_impacts)==null?void 0:C.map((s,r)=>e.jsxs("div",{className:"mb-2 flex gap-2 border-b pb-2",children:[e.jsx(v,{type:"text",placeholder:"Title",value:s.title,onChange:t=>N(r,"title",t.target.value),required:!0,className:"w-1/2 rounded border p-2"}),e.jsx(ie,{placeholder:"Description",value:s.description,onChange:t=>N(r,"description",t.target.value),required:!0,className:"w-1/2 rounded border p-2"}),r>0&&e.jsx(o,{variant:"link",type:"button",size:"sm",onClick:()=>T(r),className:"p-1 text-red-500",children:"âœ–"})]},r)),e.jsx(o,{type:"button",variant:"link",onClick:L,className:"mt-2 p-0",children:"+ Add Key Impact"})]}),e.jsx(ee,{children:e.jsxs(o,{type:"submit",disabled:n,children:[n&&e.jsx(A,{className:"h-4 w-4 animate-spin"}),"Submit"]})})]})]})}),e.jsx(R,{open:I,onOpenChange:j,children:e.jsxs(P,{children:[e.jsxs($,{children:[e.jsxs(H,{children:['Delete "',e.jsx("b",{children:i==null?void 0:i.year}),' Report"?']}),e.jsx(Y,{children:"This will delete the item and all related data continue?"})]}),e.jsxs(U,{children:[e.jsx(G,{children:"Cancel"}),e.jsxs(J,{variant:"destructive",disabled:n,onClick:D,children:[n&&e.jsx(A,{className:"animate-spin"}),"Delete"]})]})]})})]})}export{Be as default};
